doc:
  - WIP! May not be functional!
  - >
    A simple crystal plasticity simulation using DAMASK. A volume element generated from a
    random voronoi tessellation is loaded uniaxially, using aluminium (Al) material
    parameters.
tasks:
  - schema: define_volume_element
    inputs:
      volume_element::from_random_voronoi:
        size: [1, 1, 1]
        grid_size: [8, 8, 8]
        num_grains: 4
        homog_label: SX
        phase_labels: [Al]
        orientations: <<parameter:orientations>>
        orientations::from_random:
          number: 4

  - schema: generate_volume_element
    inputs:
      microstructure_seeds::from_random:
        num_seeds: 4
        box_size: [1, 1, 1]
      VE_grid_size: [8, 8, 8]
      homog_label: SX
      orientations::from_random:
        number: 4

  - schema: simulate_VE_loading_damask
    sequences:
      - path: inputs.load_case.num_increments
        values::from_range: [0, 100, 2]
        nesting_order: 0
      - path: inputs.load_case.num_increments
        values::from_normal: [0, 100, 2]
        nesting_order: 0

    inputs:
      load_case::uniaxial:
        total_time: 100
        num_increments: 200
        direction: x
        target_def_grad_rate: 1.0e-3
        dump_frequency: 1
      homogenization:
        SX:
          mechanical: { type: "pass" }
          N_constituents: 1
      damask_phases:
        Al:
          lattice: cF
          mechanical:
            output: [F, P, F_e, F_p, L_p, O]
            elastic:
              type: Hooke
              C_11: 106750000000
              C_12: 60410000000
              C_44: 28340000000
            plastic:
              type: phenopowerlaw
              N_sl: [12]
              a_sl: 2.25
              atol_xi: 1
              dot_gamma_0_sl: 0.001
              h_0_sl-sl: 75.0e+6
              h_sl-sl: [1, 1, 1.4, 1.4, 1.4, 1.4, 1.4]
              n_sl: 20
              output: [xi_sl]
              xi_0_sl: [31.0e+6]
              xi_inf_sl: [63.0e+6]
      damask_post_processing:
        - name: add_stress_Cauchy
          args: { P: P, F: F }
          opts: { add_Mises: true }
        - name: add_strain
          args: { F: F, t: V, m: 0 }
          opts: { add_Mises: true }
        - name: add_strain
          args: { F: F_p, t: V, m: 0 }
          opts: { add_Mises: true }
        - name: add_IPF_color
          args: { l: [0, 0, 1] }
      VE_response_data:
        phase_data:
          - field_name: sigma_vM
            phase_name: Al
            out_name: vol_avg_equivalent_stress
            transforms: [{ mean_along_axes: 1 }]
          - field_name: epsilon_V^0(F)_vM
            phase_name: Al
            out_name: vol_avg_equivalent_strain
            transforms: [{ mean_along_axes: 1 }]
          - field_name: epsilon_V^0(F_p)_vM
            phase_name: Al
            out_name: vol_avg_equivalent_plastic_strain
            transforms: [{ mean_along_axes: 1 }]
        field_data:
          - field_name: phase
          - field_name: O
        grain_data:
          - field_name: O
            increments: [{ values: [0, -1] }]
      damask_viz:
        fields: [F, F_p, P, sigma_vM, epsilon_V^0(F_p)_vM, IPFcolor_(0 0 1), phase]
        increments:
          - step: 20
